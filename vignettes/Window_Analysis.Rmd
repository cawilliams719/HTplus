---
title: "Window Analysis"
author: "Caroline Williams"
output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
vignette: >
  %\VignetteIndexEntry{Window Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Next Steps
- Window Analysis
  1. create window around each station
    a. buffer 495 m
    b. Feature envelop to polygon
  2. Extract by Area + Tabulate area for each year
  
## Arcpy Testing 
```{r}
library(RPyGeo)
#use_python("C:/Program Files/ArcGIS/Pro/bin/Python/", required = TRUE)
rpygeo_build_env(path = "C:/Program Files/ArcGIS/Pro/bin/Python/envs/arcgispro-py3/")
```

## Find arcpy functions
```{r}
rpygeo_help(arcpy_function = "arcpy.gp.ExtractByMask_sa")
```

## Import Libraries
```{python}
import arcpy
from arcpy import env
from arcpy.sa import *
```

# Set Workspace
```{python}
# set environment
env.workspace = "D:/"
```

# Create Buffer around Stations
```{python}
# buffer 495 m around station points
arcpy.Buffer_analysis(in_features = "r_outputs/NE1_pts.shp", out_feature_class = "python_outputs/NE1_495buff.shp", buffer_distance_or_field = "495 Meters", line_side = "FULL", line_end_type = "ROUND", dissolve_option = "NONE", dissolve_field = "", method = "PLANAR")

# create window around stations using buffer output
arcpy.FeatureEnvelopeToPolygon_management(in_features="python_outputs/NE1_495buff.shp", out_feature_class="python_outputs/NE1_window.shp", single_envelope="SINGLEPART")

# extract by mask for each year
NE1_2005_window = ExtractByMask("/data/landcover_2005_vote.tif", "/python_outputs/NE1_window.shp")

NE1_2005_window.save("D:/python_outputs/NE1_2005_window.tif")

# Polygon to Raster
arcpy.conversion.PolygonToRaster("D:/python_outputs/NE1_window.shp", "station", "D:/python_outputs/NE1_window_raster.tif", "CELL_CENTER", "NONE", 30)

# tabulate area for each year
TabulateArea("D:/python_outputs/NE1_window_raster.tif", "VALUE", "python_outputs/NE1_2005_window.tif", "VALUE", "D:/python_outputs/area2005.dbf", 30)
```

## plots of python outputs
```{r}
NE1_window_raster <- rpygeo_load("D:/python_outputs/NE1_window_raster.tif")
plot(NE1_window_raster)
```

